jQuery.fn.exists=function(){return jQuery(this).length>0};jQuery(document).ready(function($){if($(".plupload-upload-uic").exists()){var pconfig=false;$(".plupload-upload-uic").each(function(){var $this=$(this);var id1=$this.attr("id");var imgId=id1.replace("plupload-upload-ui","");plu_show_thumbs(imgId);pconfig=JSON.parse(JSON.stringify(base_plupload_config));pconfig.browse_button=imgId+pconfig.browse_button;pconfig.container=imgId+pconfig.container;pconfig.drop_element=imgId+pconfig.drop_element;pconfig.file_data_name=imgId+pconfig.file_data_name;pconfig.multipart_params["imgid"]=imgId;pconfig.multipart_params["_ajax_nonce"]=$this.find(".ajaxnonceplu").attr("id").replace("ajaxnonceplu","");if($this.hasClass("plupload-upload-uic-multiple")){pconfig.multi_selection=true}if($this.find(".plupload-resize").exists()){var w=parseInt($this.find(".plupload-width").attr("id").replace("plupload-width",""));var h=parseInt($this.find(".plupload-height").attr("id").replace("plupload-height",""));pconfig.resize={width:w,height:h,quality:90}}var uploader=new plupload.Uploader(pconfig);uploader.bind("Init",function(up){});uploader.init();uploader.bind("FilesAdded",function(up,files){$.each(files,function(i,file){$this.find(".filelist").append('<div class="file" id="'+file.id+'"><b>'+file.name+"</b> (<span>"+plupload.formatSize(0)+"</span>/"+plupload.formatSize(file.size)+') <div class="fileprogress"></div></div>')});up.refresh();up.start()});uploader.bind("UploadProgress",function(up,file){$("#"+file.id+" .fileprogress").width(file.percent+"%");$("#"+file.id+" span").html(plupload.formatSize(parseInt(file.size*file.percent/100)))});uploader.bind("FileUploaded",function(up,file,response){response=response.response;$("#"+file.id).fadeOut();if(response.indexOf("error|")>-1){alert(response.replace("error|",""));return}if($this.data("js_func")&&$this.data("js_func").length>0){eval($this.data("js_func")+"('"+response+"');");return}if($this.hasClass("plupload-upload-uic-multiple")){var v1=$.trim($("#"+imgId).val());if(v1){v1=v1+","+response}else{v1=response}$("#"+imgId).val(v1)}else{$("#"+imgId).val(response+"")}plu_show_thumbs(imgId)})})}});function plu_show_thumbs(c){var f=jQuery;var g=f("#"+c+"plupload-thumbs");g.html("");var e=f("#"+c).val();var a=e.split(",");for(var d=0;d<a.length;d++){if(a[d]){var b=f('<div class="thumb" id="thumb'+c+d+'"><img src="'+a[d]+'" alt="" /><div class="thumbi"><a id="thumbremovelink'+c+d+'" href="#">Remove</a></div> <div class="clear"></div></div>');g.append(b);b.find("a").click(function(){var k=f(this).attr("id").replace("thumbremovelink"+c,"");k=parseInt(k);var i=[];e=f("#"+c).val();a=e.split(",");for(var h=0;h<a.length;h++){if(h!=k){i[i.length]=a[h]}}f("#"+c).val(i.join());plu_show_thumbs(c);return false})}}if(a.length>1){g.sortable({update:function(i,j){var h=[];g.find("img").each(function(){h[h.length]=f(this).attr("src");f("#"+c).val(h.join());plu_show_thumbs(c)})}});g.disableSelection()}};